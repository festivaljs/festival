var holiday = {
	"20070101": "元旦",
	"20070102": "元旦",
	"20070103": "元旦",
	"20070218": "春节",
	"20070219": "春节",
	"20070220": "春节",
	"20070221": "春节",
	"20070222": "春节",
	"20070223": "春节",
	"20070224": "春节",
	"20070501": "劳动节",
	"20070502": "劳动节",
	"20070503": "劳动节",
	"20070504": "劳动节",
	"20070505": "劳动节",
	"20070506": "劳动节",
	"20070507": "劳动节",
	"20071001": "国庆节",
	"20071002": "国庆节",
	"20071003": "国庆节",
	"20071004": "国庆节",
	"20071005": "国庆节",
	"20071006": "国庆节",
	"20071007": "国庆节",
	"20071230": "元旦",
	"20071231": "元旦",
	"20080101": "元旦",
	"20080206": "春节",
	"20080207": "春节",
	"20080208": "春节",
	"20080209": "春节",
	"20080210": "春节",
	"20080211": "春节",
	"20080212": "春节",
	"20080404": "清明节",
	"20080405": "清明节",
	"20080406": "清明节",
	"20080501": "劳动节",
	"20080502": "劳动节",
	"20080503": "劳动节",
	"20080607": "端午节",
	"20080608": "端午节",
	"20080609": "端午节",
	"20080913": "中秋节",
	"20080914": "中秋节",
	"20080915": "中秋节",
	"20080929": "国庆节",
	"20080930": "国庆节",
	"20081001": "国庆节",
	"20081002": "国庆节",
	"20081003": "国庆节",
	"20081004": "国庆节",
	"20081005": "国庆节",
	"20090101": "元旦",
	"20090102": "元旦",
	"20090103": "元旦",
	"20090125": "春节",
	"20090126": "春节",
	"20090127": "春节",
	"20090128": "春节",
	"20090129": "春节",
	"20090130": "春节",
	"20090131": "春节",
	"20090404": "清明节",
	"20090405": "清明节",
	"20090406": "清明节",
	"20090501": "劳动节",
	"20090502": "劳动节",
	"20090503": "劳动节",
	"20090528": "端午节",
	"20090529": "端午节",
	"20090530": "端午节",
	"20091001": "国庆节",
	"20091002": "国庆节",
	"20091003": "国庆节",
	"20091004": "国庆节",
	"20091005": "国庆节",
	"20091006": "国庆节",
	"20091007": "国庆节",
	"20091008": "国庆节",
	"20100101": "元旦",
	"20100102": "元旦",
	"20100103": "元旦",
	"20100213": "春节",
	"20100214": "春节",
	"20100215": "春节",
	"20100216": "春节",
	"20100217": "春节",
	"20100218": "春节",
	"20100219": "春节",
	"20100403": "清明节",
	"20100404": "清明节",
	"20100405": "清明节",
	"20100501": "劳动节",
	"20100502": "劳动节",
	"20100503": "劳动节",
	"20100614": "端午节",
	"20100615": "端午节",
	"20100616": "端午节",
	"20100922": "中秋节",
	"20100923": "中秋节",
	"20100924": "中秋节",
	"20101001": "国庆节",
	"20101002": "国庆节",
	"20101003": "国庆节",
	"20101004": "国庆节",
	"20101005": "国庆节",
	"20101006": "国庆节",
	"20101007": "国庆节",
	"20110101": "元旦",
	"20110102": "元旦",
	"20110103": "元旦",
	"20110202": "春节",
	"20110203": "春节",
	"20110204": "春节",
	"20110205": "春节",
	"20110206": "春节",
	"20110207": "春节",
	"20110208": "春节",
	"20110403": "清明节",
	"20110404": "清明节",
	"20110405": "清明节",
	"20110430": "劳动节",
	"20110501": "劳动节",
	"20110502": "劳动节",
	"20110604": "端午节",
	"20110605": "端午节",
	"20110606": "端午节",
	"20110910": "中秋节",
	"20110911": "中秋节",
	"20110912": "中秋节",
	"20111001": "国庆节",
	"20111002": "国庆节",
	"20111003": "国庆节",
	"20111004": "国庆节",
	"20111005": "国庆节",
	"20111006": "国庆节",
	"20111007": "国庆节",
	"20120101": "元旦",
	"20120102": "元旦",
	"20120103": "元旦",
	"20120122": "春节",
	"20120123": "春节",
	"20120124": "春节",
	"20120125": "春节",
	"20120126": "春节",
	"20120127": "春节",
	"20120128": "春节",
	"20120402": "清明节",
	"20120403": "清明节",
	"20120404": "清明节",
	"20120429": "劳动节",
	"20120430": "劳动节",
	"20120501": "劳动节",
	"20120622": "端午节",
	"20120623": "端午节",
	"20120624": "端午节",
	"20120930": "国庆节",
	"20121001": "国庆节",
	"20121002": "国庆节",
	"20121003": "国庆节",
	"20121004": "国庆节",
	"20121005": "国庆节",
	"20121006": "国庆节",
	"20121007": "国庆节",
	"20130101": "元旦",
	"20130102": "元旦",
	"20130103": "元旦",
	"20130209": "春节",
	"20130210": "春节",
	"20130211": "春节",
	"20130212": "春节",
	"20130213": "春节",
	"20130214": "春节",
	"20130215": "春节",
	"20130404": "清明节",
	"20130405": "清明节",
	"20130406": "清明节",
	"20130429": "劳动节",
	"20130430": "劳动节",
	"20130501": "劳动节",
	"20130610": "端午节",
	"20130611": "端午节",
	"20130612": "端午节",
	"20130919": "中秋节",
	"20130920": "中秋节",
	"20130921": "中秋节",
	"20131001": "国庆节",
	"20131002": "国庆节",
	"20131003": "国庆节",
	"20131004": "国庆节",
	"20131005": "国庆节",
	"20131006": "国庆节",
	"20131007": "国庆节",
	"20140101": "元旦",
	"20140131": "春节",
	"20140201": "春节",
	"20140202": "春节",
	"20140203": "春节",
	"20140204": "春节",
	"20140205": "春节",
	"20140206": "春节",
	"20140405": "清明节",
	"20140406": "清明节",
	"20140407": "清明节",
	"20140501": "劳动节",
	"20140502": "劳动节",
	"20140503": "劳动节",
	"20140531": "端午节",
	"20140601": "端午节",
	"20140602": "端午节",
	"20140906": "中秋节",
	"20140907": "中秋节",
	"20140908": "中秋节",
	"20141001": "国庆节",
	"20141002": "国庆节",
	"20141003": "国庆节",
	"20141004": "国庆节",
	"20141005": "国庆节",
	"20141006": "国庆节",
	"20141007": "国庆节",
	"20150101": "元旦",
	"20150102": "元旦",
	"20150103": "元旦",
	"20150218": "春节",
	"20150219": "春节",
	"20150220": "春节",
	"20150221": "春节",
	"20150222": "春节",
	"20150223": "春节",
	"20150224": "春节",
	"20150404": "清明节",
	"20150405": "清明节",
	"20150406": "清明节",
	"20150501": "劳动节",
	"20150502": "劳动节",
	"20150503": "劳动节",
	"20150620": "端午节",
	"20150621": "端午节",
	"20150622": "端午节",
	"20150903": "非节假日",
	"20150904": "非节假日",
	"20150905": "非节假日",
	"20150926": "中秋节",
	"20150927": "中秋节",
	"20151001": "国庆节",
	"20151002": "国庆节",
	"20151003": "国庆节",
	"20151004": "国庆节",
	"20151005": "国庆节",
	"20151006": "国庆节",
	"20151007": "国庆节",
	"20160101": "元旦",
	"20160102": "元旦",
	"20160103": "元旦",
	"20160207": "春节",
	"20160208": "春节",
	"20160209": "春节",
	"20160210": "春节",
	"20160211": "春节",
	"20160212": "春节",
	"20160213": "春节",
	"20160402": "清明节",
	"20160403": "清明节",
	"20160404": "清明节",
	"20160430": "劳动节",
	"20160501": "劳动节",
	"20160502": "劳动节",
	"20160609": "端午节",
	"20160610": "端午节",
	"20160611": "端午节",
	"20160915": "中秋节",
	"20160916": "中秋节",
	"20160917": "中秋节",
	"20161001": "国庆节",
	"20161002": "国庆节",
	"20161003": "国庆节",
	"20161004": "国庆节",
	"20161005": "国庆节",
	"20161006": "国庆节",
	"20161007": "国庆节",
	"20161231": "元旦",
	"20170101": "元旦",
	"20170102": "元旦",
	"20170127": "春节",
	"20170128": "春节",
	"20170129": "春节",
	"20170130": "春节",
	"20170131": "春节",
	"20170201": "春节",
	"20170202": "春节",
	"20170402": "清明节",
	"20170403": "清明节",
	"20170404": "清明节",
	"20170429": "劳动节",
	"20170430": "劳动节",
	"20170501": "劳动节",
	"20170528": "端午节",
	"20170529": "端午节",
	"20170530": "端午节",
	"20171001": "国庆节",
	"20171002": "国庆节",
	"20171003": "国庆节",
	"20171004": "国庆节",
	"20171005": "国庆节",
	"20171006": "国庆节",
	"20171007": "国庆节",
	"20171008": "国庆节",
	"20171230": "元旦",
	"20171231": "元旦",
	"20180101": "元旦",
	"20180215": "春节",
	"20180216": "春节",
	"20180217": "春节",
	"20180218": "春节",
	"20180219": "春节",
	"20180220": "春节",
	"20180221": "春节",
	"20180405": "清明节",
	"20180406": "清明节",
	"20180407": "清明节",
	"20180429": "劳动节",
	"20180430": "劳动节",
	"20180501": "劳动节",
	"20180616": "端午节",
	"20180617": "端午节",
	"20180618": "端午节",
	"20180922": "中秋节",
	"20180923": "中秋节",
	"20180924": "中秋节",
	"20181001": "国庆节",
	"20181002": "国庆节",
	"20181003": "国庆节",
	"20181004": "国庆节",
	"20181005": "国庆节",
	"20181006": "国庆节",
	"20181007": "国庆节",
	"20181230": "元旦",
	"20181231": "元旦",
	"20190101": "元旦",
	"20190204": "春节",
	"20190205": "春节",
	"20190206": "春节",
	"20190207": "春节",
	"20190208": "春节",
	"20190209": "春节",
	"20190210": "春节",
	"20190405": "清明节",
	"20190406": "清明节",
	"20190407": "清明节",
	"20190501": "劳动节",
	"20190502": "劳动节",
	"20190503": "劳动节",
	"20190504": "劳动节",
	"20190607": "端午节",
	"20190608": "端午节",
	"20190609": "端午节",
	"20190913": "中秋节",
	"20190914": "中秋节",
	"20190915": "中秋节",
	"20191001": "国庆节",
	"20191002": "国庆节",
	"20191003": "国庆节",
	"20191004": "国庆节",
	"20191005": "国庆节",
	"20191006": "国庆节",
	"20191007": "国庆节",
	"20200101": "元旦",
	"20200124": "春节",
	"20200125": "春节",
	"20200126": "春节",
	"20200127": "春节",
	"20200128": "春节",
	"20200129": "春节",
	"20200130": "春节",
	"20200131": "春节",
	"20200201": "春节",
	"20200202": "春节",
	"20200404": "清明节",
	"20200405": "清明节",
	"20200406": "清明节",
	"20200501": "劳动节",
	"20200502": "劳动节",
	"20200503": "劳动节",
	"20200504": "劳动节",
	"20200505": "劳动节",
	"20200625": "端午节",
	"20200626": "端午节",
	"20200627": "端午节",
	"20201001": "国庆节",
	"20201002": "国庆节",
	"20201003": "国庆节",
	"20201004": "国庆节",
	"20201005": "国庆节",
	"20201006": "国庆节",
	"20201007": "国庆节",
	"20201008": "国庆节",
	"20210101": "元旦",
	"20210102": "元旦",
	"20210103": "元旦",
	"20210211": "春节",
	"20210212": "春节",
	"20210213": "春节",
	"20210214": "春节",
	"20210215": "春节",
	"20210216": "春节",
	"20210217": "春节",
	"20210403": "清明节",
	"20210404": "清明节",
	"20210405": "清明节",
	"20210501": "劳动节",
	"20210502": "劳动节",
	"20210503": "劳动节",
	"20210504": "劳动节",
	"20210505": "劳动节",
	"20210612": "端午节",
	"20210613": "端午节",
	"20210614": "端午节",
	"20210919": "中秋节",
	"20210920": "中秋节",
	"20210921": "中秋节",
	"20211001": "国庆节",
	"20211002": "国庆节",
	"20211003": "国庆节",
	"20211004": "国庆节",
	"20211005": "国庆节",
	"20211006": "国庆节",
	"20211007": "国庆节",
	"20220101": "元旦",
	"20220102": "元旦",
	"20220103": "元旦",
	"20220131": "春节",
	"20220201": "春节",
	"20220202": "春节",
	"20220203": "春节",
	"20220204": "春节",
	"20220205": "春节",
	"20220206": "春节",
	"20220403": "清明节",
	"20220404": "清明节",
	"20220405": "清明节",
	"20220430": "劳动节",
	"20220501": "劳动节",
	"20220502": "劳动节",
	"20220503": "劳动节",
	"20220504": "劳动节",
	"20220603": "端午节",
	"20220604": "端午节",
	"20220605": "端午节",
	"20220910": "中秋节",
	"20220911": "中秋节",
	"20220912": "中秋节",
	"20221001": "国庆节",
	"20221002": "国庆节",
	"20221003": "国庆节",
	"20221004": "国庆节",
	"20221005": "国庆节",
	"20221006": "国庆节",
	"20221007": "国庆节",
	"20221231": "元旦",
	"20230101": "元旦",
	"20230102": "元旦",
	"20230121": "春节",
	"20230122": "春节",
	"20230123": "春节",
	"20230124": "春节",
	"20230125": "春节",
	"20230126": "春节",
	"20230127": "春节",
	"20230405": "清明节",
	"20230429": "劳动节",
	"20230430": "劳动节",
	"20230501": "劳动节",
	"20230502": "劳动节",
	"20230503": "劳动节",
	"20230622": "端午节",
	"20230623": "端午节",
	"20230624": "端午节",
	"20230929": "中秋节",
	"20230930": "国庆节",
	"20231001": "国庆节",
	"20231002": "国庆节",
	"20231003": "国庆节",
	"20231004": "国庆节",
	"20231005": "国庆节",
	"20231006": "国庆节",
	"20240101": "元旦",
	"20240210": "春节",
	"20240211": "春节",
	"20240212": "春节",
	"20240213": "春节",
	"20240214": "春节",
	"20240215": "春节",
	"20240216": "春节",
	"20240217": "春节",
	"20240404": "清明节",
	"20240405": "清明节",
	"20240406": "清明节",
	"20240501": "劳动节",
	"20240502": "劳动节",
	"20240503": "劳动节",
	"20240504": "劳动节",
	"20240505": "劳动节",
	"20240608": "端午节",
	"20240609": "端午节",
	"20240610": "端午节",
	"20240915": "中秋节",
	"20240916": "中秋节",
	"20240917": "中秋节",
	"20241001": "国庆节",
	"20241002": "国庆节",
	"20241003": "国庆节",
	"20241004": "国庆节",
	"20241005": "国庆节",
	"20241006": "国庆节",
	"20241007": "国庆节",
	"20241230": "元旦",
	"20241231": "元旦",
	"20250101": "元旦",
	"20250128": "春节",
	"20250129": "春节",
	"20250130": "春节",
	"20250131": "春节",
	"20250201": "春节",
	"20250202": "春节",
	"20250203": "春节",
	"20250204": "春节",
	"20250404": "清明节",
	"20250405": "清明节",
	"20250406": "清明节",
	"20250501": "劳动节",
	"20250502": "劳动节",
	"20250503": "劳动节",
	"20250504": "劳动节",
	"20250505": "劳动节",
	"20250531": "端午节",
	"20250601": "端午节",
	"20250602": "端午节",
	"20251001": "国庆节",
	"20251002": "国庆节",
	"20251003": "国庆节",
	"20251004": "国庆节",
	"20251005": "国庆节",
	"20251006": "国庆节",
	"20251007": "国庆节",
	"20251008": "国庆节"
};

var legal = [
	20070101,
	20070218,
	20070219,
	20070220,
	20070501,
	20070502,
	20070503,
	20071001,
	20071002,
	20071003,
	20080101,
	20080206,
	20080207,
	20080208,
	20080404,
	20080501,
	20080608,
	20080914,
	20081001,
	20081002,
	20081003,
	20090101,
	20090125,
	20090126,
	20090127,
	20090404,
	20090501,
	20090528,
	20091001,
	20091002,
	20091003,
	20100101,
	20100213,
	20100214,
	20100215,
	20100405,
	20100501,
	20100616,
	20100922,
	20101001,
	20101002,
	20101003,
	20110101,
	20110202,
	20110203,
	20110204,
	20110405,
	20110501,
	20110606,
	20110912,
	20111001,
	20111002,
	20111003,
	20120101,
	20120122,
	20120123,
	20120124,
	20120404,
	20120501,
	20120623,
	20120930,
	20121001,
	20121002,
	20121003,
	20130101,
	20130209,
	20130210,
	20130211,
	20130404,
	20130501,
	20130612,
	20130919,
	20131001,
	20131002,
	20131003,
	20140101,
	20140131,
	20140201,
	20140202,
	20140405,
	20140501,
	20140602,
	20140908,
	20141001,
	20141002,
	20141003,
	20150101,
	20150218,
	20150219,
	20150220,
	20150405,
	20150501,
	20150620,
	20150927,
	20151001,
	20151002,
	20151003,
	20160101,
	20160207,
	20160208,
	20160209,
	20160404,
	20160501,
	20160609,
	20160915,
	20161001,
	20161002,
	20161003,
	20170101,
	20170127,
	20170128,
	20170129,
	20170404,
	20170501,
	20170530,
	20171001,
	20171002,
	20171003,
	20171004,
	20180101,
	20180216,
	20180217,
	20180218,
	20180405,
	20180501,
	20180618,
	20180924,
	20181001,
	20181002,
	20181003,
	20190101,
	20190205,
	20190206,
	20190207,
	20190405,
	20190501,
	20190607,
	20190913,
	20191001,
	20191002,
	20191003,
	20200101,
	20200125,
	20200126,
	20200127,
	20200404,
	20200501,
	20200625,
	20201001,
	20201002,
	20201003,
	20201004,
	20210101,
	20210212,
	20210213,
	20210214,
	20210404,
	20210501,
	20210614,
	20210921,
	20211001,
	20211002,
	20211003,
	20220101,
	20220201,
	20220202,
	20220203,
	20220405,
	20220501,
	20220603,
	20220910,
	20221001,
	20221002,
	20221003,
	20230101,
	20230122,
	20230123,
	20230124,
	20230405,
	20230501,
	20230622,
	20230929,
	20231001,
	20231002,
	20231003,
	20240101,
	20240210,
	20240211,
	20240212,
	20240404,
	20240501,
	20240610,
	20240917,
	20241001,
	20241002,
	20241003,
	20250101,
	20250128,
	20250129,
	20250130,
	20250131,
	20250404,
	20250501,
	20250502,
	20250531,
	20251001,
	20251002,
	20251003,
	20251006
];

var swap = [
	20070217,
	20070225,
	20070428,
	20070429,
	20070929,
	20070930,
	20071229,
	20080202,
	20080203,
	20080504,
	20080927,
	20080928,
	20090104,
	20090124,
	20090201,
	20090531,
	20091010,
	20091027,
	20100220,
	20100221,
	20100612,
	20100613,
	20100919,
	20100925,
	20100926,
	20101009,
	20110130,
	20110212,
	20110402,
	20111008,
	20111009,
	20111231,
	20120121,
	20120129,
	20120331,
	20120401,
	20120428,
	20120929,
	20130105,
	20130106,
	20130216,
	20130217,
	20130407,
	20130427,
	20130428,
	20130608,
	20130609,
	20130922,
	20130929,
	20131012,
	20140126,
	20140208,
	20140504,
	20140928,
	20141011,
	20150104,
	20150215,
	20150228,
	20151010,
	20160206,
	20160214,
	20160612,
	20160918,
	20161008,
	20161009,
	20170122,
	20170204,
	20170401,
	20170527,
	20170930,
	20180211,
	20180224,
	20180408,
	20180428,
	20180929,
	20180930,
	20181229,
	20190202,
	20190203,
	20190428,
	20190505,
	20190929,
	20191012,
	20200119,
	20200426,
	20200509,
	20200628,
	20200927,
	20201010,
	20210207,
	20210220,
	20210425,
	20210508,
	20210918,
	20210926,
	20211009,
	20220129,
	20220130,
	20220402,
	20220424,
	20220507,
	20221008,
	20221009,
	20230128,
	20230129,
	20230423,
	20230506,
	20230625,
	20231007,
	20231008,
	20240204,
	20240217,
	20240407,
	20240427,
	20240428,
	20240928,
	20240929,
	20250126,
	20250208,
	20250427,
	20250928,
	20251011
];

/**
 * 数据预处理器 - 优化数据结构以提升查询性能
 */


class DataProcessor {
  constructor() {
    this.processedData = this.preprocessData();
  }

  /**
   * 预处理数据，构建高效的查询索引
   */
  preprocessData() {
    // 构建快速查询的Set结构
    const holidaySet = new Set(Object.keys(holiday).map(Number));
    const legalSet = new Set(legal.map(Number));
    const swapSet = new Set(swap.map(Number));
    
    // 按年份组织数据，提升范围查询性能
    const yearlyData = this.buildYearlyIndex(holiday, legal, swap);
    
    // 计算数据边界
    const allDates = [...holidaySet, ...legalSet, ...swapSet];
    const dataRange = {
      minDate: Math.min(...allDates),
      maxDate: Math.max(...allDates),
      years: this.extractYears(allDates)
    };

    return {
      // 原始查询集合
      holidayMap: new Map(Object.entries(holiday).map(([date, name]) => [Number(date), name])),
      holidaySet,
      legalSet,
      swapSet,
      
      // 优化索引
      yearlyData,
      dataRange,
      
      // 元数据
      metadata: this.generateMetadata(allDates)
    }
  }

  /**
   * 按年份构建索引，优化年度范围查询
   */
  buildYearlyIndex(holiday, legal, swap) {
    const yearlyData = new Map();
    
    // 处理节假日
    Object.entries(holiday).forEach(([dateStr, name]) => {
      const date = Number(dateStr);
      const year = Math.floor(date / 10000);
      
      if (!yearlyData.has(year)) {
        yearlyData.set(year, {
          holidays: new Map(),
          legal: new Set(),
          swap: new Set()
        });
      }
      
      yearlyData.get(year).holidays.set(date, name);
    });
    
    // 处理法定节假日
    legal.forEach(date => {
      const year = Math.floor(date / 10000);
      if (yearlyData.has(year)) {
        yearlyData.get(year).legal.add(date);
      }
    });
    
    // 处理调休日
    swap.forEach(date => {
      const year = Math.floor(date / 10000);
      if (yearlyData.has(year)) {
        yearlyData.get(year).swap.add(date);
      }
    });
    
    return yearlyData
  }

  /**
   * 提取所有涉及的年份
   */
  extractYears(dates) {
    const years = new Set();
    dates.forEach(date => {
      years.add(Math.floor(date / 10000));
    });
    return Array.from(years).sort((a, b) => a - b)
  }

  /**
   * 生成数据统计元信息
   */
  generateMetadata(dates) {
    const years = this.extractYears(dates);
    return {
      totalHolidays: Object.keys(holiday).length,
      totalLegalDays: legal.length,
      totalSwapDays: swap.length,
      yearRange: {
        start: years[0],
        end: years[years.length - 1],
        span: years.length
      },
      lastUpdated: new Date().toISOString()
    }
  }

  /**
   * 获取处理后的数据
   */
  getData() {
    return this.processedData
  }

  /**
   * 获取指定年份的数据
   */
  getYearData(year) {
    return this.processedData.yearlyData.get(year) || null
  }

  /**
   * 检查日期是否在数据范围内
   */
  isInRange(date) {
    const { minDate, maxDate } = this.processedData.dataRange;
    return date >= minDate && date <= maxDate
  }
}

/**
 * 高性能查询算法模块
 */

class QueryEngine {
  constructor(data) {
    this.data = data;
  }

  /**
   * 高效的日期范围查询 - O(log n) 复杂度
   * 使用年份索引 + Set过滤替代逐日遍历
   */
  queryRange(startDate, endDate, filter = null) {
    if (startDate > endDate) {
      throw new Error('Start date must be less than or equal to end date')
    }

    const startYear = Math.floor(startDate / 10000);
    const endYear = Math.floor(endDate / 10000);
    const results = [];

    // 按年份范围查询，避免全量遍历
    for (let year = startYear; year <= endYear; year++) {
      const yearData = this.data.yearlyData.get(year);
      if (!yearData) continue

      // 根据过滤器类型选择对应的数据集
      let targetSet;
      let dataSource;
      
      switch (filter) {
        case 'holiday':
          targetSet = new Set(yearData.holidays.keys());
          dataSource = yearData.holidays;
          break
        case 'legal':
          targetSet = yearData.legal;
          dataSource = yearData.holidays;
          break
        case 'swap':
          targetSet = yearData.swap;
          dataSource = yearData.holidays;
          break
        default:
          // 查询所有节假日
          targetSet = new Set(yearData.holidays.keys());
          dataSource = yearData.holidays;
      }

      // 在年度数据中应用日期范围过滤
      for (const date of targetSet) {
        if (date >= startDate && date <= endDate) {
          results.push(this.buildDayInfo(date, dataSource));
        }
      }
    }

    return results.sort((a, b) => a.date - b.date)
  }

  /**
   * 快速的单日查询 - O(1) 复杂度
   */
  queryDay(date) {
    if (!this.data.dataRange || date < this.data.dataRange.minDate || date > this.data.dataRange.maxDate) {
      return this.buildInvalidDayInfo(date)
    }

    return this.buildDayInfo(date, this.data.holidayMap)
  }

  /**
   * 批量日期查询优化
   */
  queryMultipleDays(dates) {
    return dates.map(date => this.queryDay(date))
  }

  /**
   * 智能范围统计 - 无需构建完整对象数组
   */
  countInRange(startDate, endDate, type = 'holiday') {
    const startYear = Math.floor(startDate / 10000);
    const endYear = Math.floor(endDate / 10000);
    let count = 0;

    for (let year = startYear; year <= endYear; year++) {
      const yearData = this.data.yearlyData.get(year);
      if (!yearData) continue

      let targetSet;
      switch (type) {
        case 'legal':
          targetSet = yearData.legal;
          break
        case 'swap':
          targetSet = yearData.swap;
          break
        default:
          targetSet = new Set(yearData.holidays.keys());
      }

      for (const date of targetSet) {
        if (date >= startDate && date <= endDate) {
          count++;
        }
      }
    }

    return count
  }

  /**
   * 按年份快速查询
   */
  queryYear(year, type = 'all') {
    const yearData = this.data.yearlyData.get(year);
    if (!yearData) return []

    const results = [];
    
    switch (type) {
      case 'legal':
        yearData.legal.forEach(date => {
          results.push(this.buildDayInfo(date, yearData.holidays));
        });
        break
      case 'swap':
        yearData.swap.forEach(date => {
          results.push(this.buildDayInfo(date, yearData.holidays));
        });
        break
      default:
        yearData.holidays.forEach((name, date) => {
          results.push(this.buildDayInfo(date, yearData.holidays));
        });
    }

    return results.sort((a, b) => a.date - b.date)
  }

  /**
   * 构建标准的日期信息对象
   */
  buildDayInfo(date, dataSource) {
    const name = (dataSource instanceof Map) 
      ? dataSource.get(date) || this.data.holidayMap.get(date) || '工作日'
      : this.data.holidayMap.get(date) || '工作日';
    
    return {
      date,
      name,
      isHoliday: this.data.holidaySet.has(date),
      isLegal: this.data.legalSet.has(date),
      isSwap: this.data.swapSet.has(date)
    }
  }

  /**
   * 构建无效日期信息
   */
  buildInvalidDayInfo(date) {
    return {
      date,
      name: '超出数据范围',
      isHoliday: false,
      isLegal: false,
      isSwap: false,
      isValid: false
    }
  }

  /**
   * 获取节假日名称列表（去重）
   */
  getHolidayNames() {
    const names = new Set();
    this.data.holidayMap.forEach(name => names.add(name));
    return Array.from(names).filter(name => name !== '工作日')
  }

  /**
   * 按节假日名称查询所有相关日期
   */
  queryByHolidayName(holidayName) {
    const results = [];
    this.data.holidayMap.forEach((name, date) => {
      if (name === holidayName) {
        results.push(this.buildDayInfo(date, this.data.holidayMap));
      }
    });
    return results.sort((a, b) => a.date - b.date)
  }
}

/**
 * 智能缓存管理器 - LRU缓存实现
 * 优化重复查询性能，特别是范围查询和批量操作
 */

class CacheManager {
  constructor(maxSize = 1000) {
    this.maxSize = maxSize;
    this.cache = new Map();
    this.stats = {
      hits: 0,
      misses: 0,
      evictions: 0,
      operations: 0
    };
  }

  /**
   * 获取缓存值
   * @param {string} key - 缓存键
   * @returns {*} 缓存值或undefined
   */
  get(key) {
    this.stats.operations++;
    
    if (this.cache.has(key)) {
      // LRU策略：访问时移到最后
      const value = this.cache.get(key);
      this.cache.delete(key);
      this.cache.set(key, value);
      this.stats.hits++;
      return value
    }
    
    this.stats.misses++;
    return undefined
  }

  /**
   * 设置缓存值
   * @param {string} key - 缓存键
   * @param {*} value - 缓存值
   */
  set(key, value) {
    this.stats.operations++;
    
    // 如果已存在，先删除旧值
    if (this.cache.has(key)) {
      this.cache.delete(key);
    } else if (this.cache.size >= this.maxSize) {
      // 达到最大容量，删除最老的条目（Map中第一个）
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
      this.stats.evictions++;
    }
    
    this.cache.set(key, value);
  }

  /**
   * 检查缓存是否存在
   * @param {string} key - 缓存键
   * @returns {boolean}
   */
  has(key) {
    return this.cache.has(key)
  }

  /**
   * 删除指定缓存
   * @param {string} key - 缓存键
   * @returns {boolean} 是否删除成功
   */
  delete(key) {
    return this.cache.delete(key)
  }

  /**
   * 清空所有缓存
   */
  clear() {
    this.cache.clear();
    this.resetStats();
  }

  /**
   * 获取缓存大小
   * @returns {number}
   */
  size() {
    return this.cache.size
  }

  /**
   * 获取缓存统计信息
   * @returns {Object}
   */
  getStats() {
    const hitRate = this.stats.operations > 0 
      ? (this.stats.hits / this.stats.operations * 100).toFixed(2)
      : 0;

    return {
      ...this.stats,
      hitRate: `${hitRate}%`,
      size: this.cache.size,
      maxSize: this.maxSize
    }
  }

  /**
   * 重置统计信息
   */
  resetStats() {
    this.stats = {
      hits: 0,
      misses: 0,
      evictions: 0,
      operations: 0
    };
  }

  /**
   * 批量预热缓存
   * @param {Array} items - 预热数据数组 [{key, value}, ...]
   */
  warmup(items) {
    items.forEach(({ key, value }) => {
      this.set(key, value);
    });
  }

  /**
   * 获取缓存键列表（用于调试）
   * @returns {Array}
   */
  keys() {
    return Array.from(this.cache.keys())
  }

  /**
   * 获取内存使用估算（粗略计算）
   * @returns {Object}
   */
  getMemoryUsage() {
    let totalSize = 0;
    
    this.cache.forEach((value, key) => {
      totalSize += this._estimateSize(key) + this._estimateSize(value);
    });

    return {
      estimatedBytes: totalSize,
      estimatedKB: (totalSize / 1024).toFixed(2),
      entries: this.cache.size
    }
  }

  /**
   * 估算对象大小（简单实现）
   * @private
   */
  _estimateSize(obj) {
    if (typeof obj === 'string') {
      return obj.length * 2 // Unicode字符大约2字节
    }
    if (typeof obj === 'number') {
      return 8 // 64位数字
    }
    if (typeof obj === 'boolean') {
      return 4
    }
    if (obj === null || obj === undefined) {
      return 0
    }
    if (typeof obj === 'object') {
      return JSON.stringify(obj).length * 2 // 粗略估算
    }
    return 0
  }

  /**
   * 缓存健康检查
   * @returns {Object}
   */
  healthCheck() {
    const stats = this.getStats();
    const memUsage = this.getMemoryUsage();
    
    return {
      healthy: stats.hitRate > 30 && this.cache.size < this.maxSize,
      hitRate: stats.hitRate,
      utilizationRate: `${(this.cache.size / this.maxSize * 100).toFixed(2)}%`,
      memoryUsage: memUsage.estimatedKB + ' KB',
      recommendations: this._getRecommendations(stats)
    }
  }

  /**
   * 获取优化建议
   * @private
   */
  _getRecommendations(stats) {
    const recommendations = [];
    
    if (stats.hitRate < 30) {
      recommendations.push('缓存命中率较低，考虑调整缓存策略或增加缓存大小');
    }
    
    if (stats.evictions > stats.hits) {
      recommendations.push('缓存频繁淘汰，建议增加缓存容量');
    }
    
    if (this.cache.size === this.maxSize) {
      recommendations.push('缓存已满，考虑增加maxSize参数');
    }
    
    return recommendations
  }
}

/**
 * Festival_chn - 高性能中国节假日查询库
 * 
 * 特性：
 * - O(1) 单日查询，O(log n) 范围查询
 * - 智能缓存和数据预处理
 * - 完整的输入验证和错误处理
 * - 支持批量操作和年度查询
 */


class Festival {
  constructor(options = {}) {
    // 初始化配置
    this.config = {
      enableCache: options.enableCache !== false, // 默认启用缓存
      cacheSize: options.cacheSize || 1000,
      strictMode: options.strictMode || false, // 严格模式下抛出异常
      ...options
    };

    // 初始化数据处理器
    this.dataProcessor = new DataProcessor();
    this.data = this.dataProcessor.getData();
    
    // 初始化查询引擎
    this.queryEngine = new QueryEngine(this.data);
    
    // 初始化缓存管理器
    this.cacheManager = this.config.enableCache 
      ? new CacheManager(this.config.cacheSize)
      : null;

    // 性能统计
    this.stats = {
      queries: 0,
      cacheHits: 0,
      errors: 0
    };
  }

  // ==================== 核心查询API ====================

  /**
   * 查询指定日期的完整信息
   * @param {number|string} date - 日期，格式为 YYYYMMDD
   * @returns {Object} 日期信息对象
   */
  day(date) {
    try {
      const normalizedDate = this._validateAndNormalizeDate(date);
      this.stats.queries++;

      // 检查缓存
      if (this.cacheManager) {
        const cached = this.cacheManager.get(`day:${normalizedDate}`);
        if (cached) {
          this.stats.cacheHits++;
          return cached
        }
      }

      const result = this.queryEngine.queryDay(normalizedDate);
      
      // 缓存结果
      if (this.cacheManager && result.isValid !== false) {
        this.cacheManager.set(`day:${normalizedDate}`, result);
      }

      return result
    } catch (error) {
      this.stats.errors++;
      return this._handleError(error, date)
    }
  }

  /**
   * 获取日期的节假日名称
   * @param {number|string} date - 日期
   * @returns {string} 节假日名称
   */
  name(date) {
    const dayInfo = this.day(date);
    return dayInfo.name || '工作日'
  }

  /**
   * 判断是否为节假日
   * @param {number|string} date - 日期
   * @returns {boolean}
   */
  isHoliday(date) {
    const dayInfo = this.day(date);
    return dayInfo.isHoliday || false
  }

  /**
   * 判断是否为法定节假日
   * @param {number|string} date - 日期
   * @returns {boolean}
   */
  isLegal(date) {
    const dayInfo = this.day(date);
    return dayInfo.isLegal || false
  }

  /**
   * 判断是否为调休日（工作日）
   * @param {number|string} date - 日期
   * @returns {boolean}
   */
  isSwap(date) {
    const dayInfo = this.day(date);
    return dayInfo.isSwap || false
  }

  // ==================== 范围查询API ====================

  /**
   * 查询日期范围内的所有节假日信息
   * @param {number|string} startDate - 开始日期
   * @param {number|string} endDate - 结束日期
   * @returns {Array} 日期信息数组
   */
  getDaysInRange(startDate, endDate) {
    try {
      const start = this._validateAndNormalizeDate(startDate);
      const end = this._validateAndNormalizeDate(endDate);
      
      const cacheKey = `range:${start}-${end}`;
      if (this.cacheManager) {
        const cached = this.cacheManager.get(cacheKey);
        if (cached) {
          this.stats.cacheHits++;
          return cached
        }
      }

      const result = this.queryEngine.queryRange(start, end);
      
      if (this.cacheManager) {
        this.cacheManager.set(cacheKey, result);
      }

      return result
    } catch (error) {
      this.stats.errors++;
      return this._handleError(error, [startDate, endDate])
    }
  }

  /**
   * 查询日期范围内的法定节假日
   * @param {number|string} startDate - 开始日期
   * @param {number|string} endDate - 结束日期
   * @returns {Array} 法定节假日数组
   */
  getLegalHolidaysInRange(startDate, endDate) {
    try {
      const start = this._validateAndNormalizeDate(startDate);
      const end = this._validateAndNormalizeDate(endDate);
      
      return this.queryEngine.queryRange(start, end, 'legal')
    } catch (error) {
      this.stats.errors++;
      return this._handleError(error, [startDate, endDate])
    }
  }

  /**
   * 查询日期范围内的调休日
   * @param {number|string} startDate - 开始日期
   * @param {number|string} endDate - 结束日期
   * @returns {Array} 调休日数组
   */
  getSwapHolidaysInRange(startDate, endDate) {
    try {
      const start = this._validateAndNormalizeDate(startDate);
      const end = this._validateAndNormalizeDate(endDate);
      
      return this.queryEngine.queryRange(start, end, 'swap')
    } catch (error) {
      this.stats.errors++;
      return this._handleError(error, [startDate, endDate])
    }
  }

  /**
   * 统计日期范围内的节假日天数
   * @param {number|string} startDate - 开始日期
   * @param {number|string} endDate - 结束日期
   * @param {string} type - 类型：'holiday', 'legal', 'swap'
   * @returns {number} 天数
   */
  countHolidaysInRange(startDate, endDate, type = 'holiday') {
    try {
      const start = this._validateAndNormalizeDate(startDate);
      const end = this._validateAndNormalizeDate(endDate);
      
      return this.queryEngine.countInRange(start, end, type)
    } catch (error) {
      this.stats.errors++;
      return this._handleError(error, [startDate, endDate])
    }
  }

  // ==================== 新增高级API ====================

  /**
   * 批量查询多个日期
   * @param {Array} dates - 日期数组
   * @returns {Array} 日期信息数组
   */
  getDays(dates) {
    if (!Array.isArray(dates)) {
      throw new Error('参数必须是日期数组')
    }

    return dates.map(date => this.day(date))
  }

  /**
   * 查询指定年份的所有节假日
   * @param {number} year - 年份
   * @param {string} type - 类型：'all', 'legal', 'swap'
   * @returns {Array} 节假日数组
   */
  getYearHolidays(year, type = 'all') {
    try {
      this._validateYear(year);
      return this.queryEngine.queryYear(year, type)
    } catch (error) {
      this.stats.errors++;
      return this._handleError(error, year)
    }
  }

  /**
   * 按节假日名称查询所有相关日期
   * @param {string} holidayName - 节假日名称
   * @returns {Array} 日期数组
   */
  getDatesByHolidayName(holidayName) {
    return this.queryEngine.queryByHolidayName(holidayName)
  }

  /**
   * 获取所有节假日名称列表
   * @returns {Array} 节假日名称数组
   */
  getHolidayNames() {
    return this.queryEngine.getHolidayNames()
  }

  // ==================== 工具方法 ====================

  /**
   * 获取数据统计信息
   * @returns {Object} 统计信息
   */
  getDataInfo() {
    return {
      ...this.data.metadata,
      stats: { ...this.stats },
      dataRange: this.data.dataRange,
      cacheEnabled: !!this.cacheManager
    }
  }

  /**
   * 清空缓存
   */
  clearCache() {
    if (this.cacheManager) {
      this.cacheManager.clear();
    }
  }

  /**
   * 重置统计信息
   */
  resetStats() {
    this.stats = {
      queries: 0,
      cacheHits: 0,
      errors: 0
    };
  }

  // ==================== 私有方法 ====================

  /**
   * 验证并标准化日期
   * @private
   */
  _validateAndNormalizeDate(date) {
    if (date == null) {
      throw new Error('日期不能为空')
    }

    const numDate = Number(date);
    
    if (isNaN(numDate)) {
      throw new Error(`无效的日期格式: ${date}`)
    }

    // 基本格式验证
    if (numDate < 19700101 || numDate > 99991231) {
      throw new Error(`日期超出有效范围: ${date}`)
    }

    // 详细日期格式验证
    const dateStr = numDate.toString();
    if (dateStr.length !== 8) {
      throw new Error(`日期格式必须为8位数字YYYYMMDD: ${date}`)
    }
    const month = Math.floor((numDate % 10000) / 100);
    const day = numDate % 100;

    if (month < 1 || month > 12) {
      throw new Error(`无效的月份: ${month}`)
    }

    if (day < 1 || day > 31) {
      throw new Error(`无效的日期: ${day}`)
    }

    return numDate
  }

  /**
   * 验证年份
   * @private
   */
  _validateYear(year) {
    const numYear = Number(year);
    if (isNaN(numYear) || numYear < 1970 || numYear > 9999) {
      throw new Error(`无效的年份: ${year}`)
    }
    return numYear
  }

  /**
   * 错误处理
   * @private
   */
  _handleError(error, input) {
    if (this.config.strictMode) {
      throw error
    }

    console.warn(`Festival查询错误: ${error.message}, 输入: ${JSON.stringify(input)}`);
    
    // 返回默认的错误结果
    return {
      date: Number(input) || 0,
      name: '查询错误',
      isHoliday: false,
      isLegal: false,
      isSwap: false,
      error: error.message
    }
  }
}

/**
 * Festival_chn - 高性能中国节假日查询库
 * 重构版本入口文件
 */


// 创建默认实例
const festival = new Festival();

// 兼容性：提供全局访问方式
if (typeof window !== 'undefined') {
  window.Festival = Festival;
  window.festival = festival;
}

// Node.js 环境兼容
if (typeof global !== 'undefined') {
  global.Festival = Festival;
  global.festival = festival;
}

export { Festival, festival as default };
//# sourceMappingURL=festival.esm.js.map
